<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PokeDash - Adicionar Pok√©mon</title>
    <link rel="icon" type="image/x-icon" href="public/favicon.ico" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
      <div class="container d-flex align-items-center justify-content-between">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="public/images/logo.png" alt="Logo" />
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="index.html#home"
                ><i class="fas fa-home me-1"></i> In√≠cio</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#types"
                ><i class="fas fa-fire me-1"></i> Tipos</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#legendary"
                ><i class="fas fa-crown me-2"></i> Lendarios</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#stats"
                ><i class="fas fa-chart-bar me-1"></i> Atributos</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="search.html"
                ><i class="fas fa-database me-1"></i> Dados</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#about"
                ><i class="fas fa-info-circle me-1"></i> Sobre</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-5">
      <h2 class="mb-4 text-center">Adicionar Pok√©mon</h2>

      <form id="addPokemonForm" style="max-width: 700px; margin: 0 auto">
        <div class="mb-3">
          <label for="name" class="form-label">Nome</label>
          <input
            type="text"
            class="form-control"
            id="name"
            name="name"
            required
          />
        </div>

        <div class="mb-3">
          <label for="pokedex_number" class="form-label"
            >N√∫mero na Pok√©dex</label
          >
          <input
            type="number"
            class="form-control"
            id="pokedex_number"
            name="pokedex_number"
            min="1"
            required
          />
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="generation" class="form-label">Gera√ß√£o</label>
            <input
              type="number"
              class="form-control"
              id="generation"
              name="generation"
              min="1"
              max="9"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="is_legendary" class="form-label">√â Lend√°rio?</label>
            <select
              class="form-select"
              id="is_legendary"
              name="is_legendary"
              required
            >
              <option value="0" selected>N√£o</option>
              <option value="1">Sim</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="type1" class="form-label">Tipo 1</label>
            <select class="form-select" id="type1" name="type1" required>
              <option value="">Selecione o tipo</option>
              <option value="bug">Bug</option>
              <option value="dark">Dark</option>
              <option value="dragon">Dragon</option>
              <option value="electric">Electric</option>
              <option value="fairy">Fairy</option>
              <option value="fight">Fight</option>
              <option value="fire">Fire</option>
              <option value="flying">Flying</option>
              <option value="ghost">Ghost</option>
              <option value="grass">Grass</option>
              <option value="ground">Ground</option>
              <option value="ice">Ice</option>
              <option value="normal">Normal</option>
              <option value="poison">Poison</option>
              <option value="psychic">Psychic</option>
              <option value="rock">Rock</option>
              <option value="steel">Steel</option>
              <option value="water">Water</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label for="type2" class="form-label">Tipo 2</label>
            <select class="form-select" id="type2" name="type2">
              <option value="">Nenhum</option>
              <option value="bug">Bug</option>
              <option value="dark">Dark</option>
              <option value="dragon">Dragon</option>
              <option value="electric">Electric</option>
              <option value="fairy">Fairy</option>
              <option value="fight">Fight</option>
              <option value="fire">Fire</option>
              <option value="flying">Flying</option>
              <option value="ghost">Ghost</option>
              <option value="grass">Grass</option>
              <option value="ground">Ground</option>
              <option value="ice">Ice</option>
              <option value="normal">Normal</option>
              <option value="poison">Poison</option>
              <option value="psychic">Psychic</option>
              <option value="rock">Rock</option>
              <option value="steel">Steel</option>
              <option value="water">Water</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="hp" class="form-label">HP</label>
            <input
              type="number"
              class="form-control"
              id="hp"
              name="hp"
              min="1"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="attack" class="form-label">Ataque</label>
            <input
              type="number"
              class="form-control"
              id="attack"
              name="attack"
              min="1"
              required
            />
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="defense" class="form-label">Defesa</label>
            <input
              type="number"
              class="form-control"
              id="defense"
              name="defense"
              min="1"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="sp_attack" class="form-label">Ataque Especial</label>
            <input
              type="number"
              class="form-control"
              id="sp_attack"
              name="sp_attack"
              min="1"
              required
            />
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="sp_defense" class="form-label">Defesa Especial</label>
            <input
              type="number"
              class="form-control"
              id="sp_defense"
              name="sp_defense"
              min="1"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="speed" class="form-label">Velocidade</label>
            <input
              type="number"
              class="form-control"
              id="speed"
              name="speed"
              min="1"
              required
            />
          </div>
        </div>

        <button type="submit" class="btn btn-pokered w-100">
          Adicionar Pok√©mon
        </button>
      </form>
    </main>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
      import { createPokemon } from "./js/api.js";
      import { BACK4APP_CONFIG } from "./config/config.js";

      const form = document.getElementById("addPokemonForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);

        const pokemonData = {
          name: formData.get("name").trim(),
          pokedex_number: Number(formData.get("pokedex_number")),
          generation: Number(formData.get("generation")),
          is_legendary: Number(formData.get("is_legendary")), // üëà alterado aqui
          type1: formData.get("type1"),
          type2: formData.get("type2") || null,
          hp: Number(formData.get("hp")),
          attack: Number(formData.get("attack")),
          defense: Number(formData.get("defense")),
          sp_attack: Number(formData.get("sp_attack")),
          sp_defense: Number(formData.get("sp_defense")),
          speed: Number(formData.get("speed")),
        };

        try {
          console.log(pokemonData);
          const result = await createPokemon(pokemonData);

          if (!result) throw new Error("Falha ao adicionar Pok√©mon");

          alert("Pok√©mon adicionado com sucesso!");
          form.reset();
        } catch (error) {
          alert(`Erro: ${error.message}`);
        }
      });

      async function setPokedexMinValue() {
        const input = document.getElementById("pokedex_number");

        try {
          const url = `${BACK4APP_CONFIG.BASE_URL}?limit=0&count=1`;
          const headers = {
            "X-Parse-Application-Id": BACK4APP_CONFIG.APP_ID,
            "X-Parse-REST-API-Key": BACK4APP_CONFIG.API_KEY,
          };

          const response = await fetch(url, { headers });
          const data = await response.json();

          const count = data.count || 0;
          const nextNumber = count + 1;

          input.min = nextNumber;
          input.value = nextNumber;
        } catch (error) {
          console.error("Erro ao definir m√≠nimo do N√∫mero na Pok√©dex:", error);
        }
      }

      setPokedexMinValue();
    </script>
  </body>
</html>
